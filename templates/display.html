<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± - Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        body {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            font-family: 'Tajawal', sans-serif;
            min-height: 100vh;
            color: white;
        }
        .display-container {
            text-align: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .status-box {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .student-info {
            background: white;
            color: #2c3e50;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }
        .manual-input {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <!-- Ø²Ø± ÙØªØ­ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
    <button class="menu-toggle" id="menuToggle">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h4>ğŸ« Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ±</h4>
        </div>
        
        <ul class="sidebar-menu">
            <li><a href="/" class="active"><i class="fas fa-home"></i> Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
            <li><a href="/daily_report"><i class="fas fa-file-alt"></i> Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ</a></li>
            <li><a href="/admin"><i class="fas fa-chart-bar"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</a></li>
            <li><a href="/manage_students"><i class="fas fa-users"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</a></li>
            <li><a href="/bulk_grades"><i class="fas fa-tasks"></i> ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</a></li>
            <li><a href="/add_student"><i class="fas fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</a></li>
            <li><a href="/generate_whatsapp_links"><i class="fab fa-whatsapp"></i> Ø±ÙˆØ§Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨</a></li>
            <li><a href="/remote_scanner" target="_blank"><i class="fas fa-camera"></i> Ø§Ù„Ù…Ø§Ø³Ø­ Ø§Ù„Ø¶ÙˆØ¦ÙŠ</a></li>
        </ul>
        
        <div class="sidebar-footer">
            <div class="user-info">
                <i class="fas fa-user"></i> {{ username }}
            </div>
            <a href="/logout" class="btn-logout">
                <i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
            </a>
        </div>
    </div>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div class="main-content">
        <div class="display-container">
            <!-- Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ© -->
            <div class="profile-image">
                <img src="{{ url_for('static', filename='50f83c12-518b-44e5-8be8-ba1db2b6cc9c.jfif.jfif') }}" 
                     alt="Mr Abanoub George" 
                     class="profile-img" style="width: 150px; height: 150px; border-radius: 50%; border: 4px solid white; margin-bottom: 20px;">
            </div>
            
            <div class="name-title" style="font-size: 2em; margin-bottom: 10px;">Mr Abanoub George</div>
            <p class="lead" style="margin-bottom: 30px;">Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø¢Ù„ÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</p>

            <!-- Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }} fade-in" style="max-width: 600px; margin: 0 auto 20px;">
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ ÙˆØ§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø³Ø­ -->
            <div class="status-box">
                <div id="connectionStatus">
                    <i class="fas fa-sync fa-spin"></i>
                    <h3>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…...</h3>
                </div>
                
                <div id="waitingMessage">
                    <i class="fas fa-hourglass-half fa-2x mb-3"></i>
                    <h4>ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ù…Ø³Ø­ Ø·Ø§Ù„Ø¨...</h4>
                    <p>Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ Ù‡Ù†Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø³Ø­</p>
                </div>
            </div>

            <!-- Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ -->
            <div class="manual-input">
                <h4><i class="fas fa-keyboard"></i> Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ Ù„Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</h4>
                <div class="row justify-content-center">
                    <div class="col-md-6">
                        <div class="input-group mb-3">
                            <input type="text" id="studentId" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ù„Ø¨" autocomplete="off">
                            <button class="btn btn-primary" onclick="sendStudentId()">
                                <i class="fas fa-paper-plane"></i> Ø¥Ø±Ø³Ø§Ù„
                            </button>
                        </div>
                    </div>
                </div>
                <small class="text-muted">ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ Ø£Ùˆ Ø§Ù„Ù…Ø§Ø³Ø­ Ø§Ù„Ø¶ÙˆØ¦ÙŠ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†</small>
            </div>

            <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ -->
            <div id="studentInfo" class="student-info">
                <h4><i class="fas fa-user-graduate"></i> Ø¬Ø§Ø±ÙŠ ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨...</h4>
                <div id="studentDetails"></div>
            </div>

            <!-- ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ -->
            <div class="instructions" style="background: rgba(255, 255, 255, 0.1); border-radius: 10px; padding: 20px; margin-top: 30px;">
                <h5><i class="fas fa-info-circle"></i> ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„:</h5>
                <div class="row text-center mt-3">
                    <div class="col-md-4">
                        <i class="fas fa-mobile-alt fa-2x mb-2"></i>
                        <p>Ø§ÙØªØ­ Ø§Ù„Ù…Ø§Ø³Ø­ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†</p>
                    </div>
                    <div class="col-md-4">
                        <i class="fas fa-camera fa-2x mb-2"></i>
                        <p>Ø§Ù…Ø³Ø­ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨</p>
                    </div>
                    <div class="col-md-4">
                        <i class="fas fa-desktop fa-2x mb-2"></i>
                        <p>Ø´Ø§Ù‡Ø¯ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù‡Ù†Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</p>
                    </div>
                </div>
                <div class="mt-3">
                    <a href="/remote_scanner" target="_blank" class="btn btn-warning">
                        <i class="fas fa-camera"></i> ÙØªØ­ Ø§Ù„Ù…Ø§Ø³Ø­ Ø§Ù„Ø¶ÙˆØ¦ÙŠ Ù„Ù„ØªÙ„ÙŠÙÙˆÙ†
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>

    <script>
        const socket = io();
        let currentStudent = null;

        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
        socket.on('connect', function() {
            document.getElementById('connectionStatus').innerHTML = 
                '<i class="fas fa-wifi"></i><h3>âœ… Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…</h3>';
        });

        socket.on('disconnect', function() {
            document.getElementById('connectionStatus').innerHTML = 
                '<i class="fas fa-plug"></i><h3>âŒ Ø§Ù†Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„</h3>';
        });

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø£Ù…Ø± ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨
        socket.on('open_student_page', function(data) {
            const studentId = data.student_id;
            currentStudent = studentId;
            
            // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨
            document.getElementById('studentInfo').style.display = 'block';
            document.getElementById('studentDetails').innerHTML = `
                <div class="alert alert-info">
                    <h5>Ø§Ù„Ø·Ø§Ù„Ø¨ Ø±Ù‚Ù…: ${studentId}</h5>
                    <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨...</p>
                </div>
            `;
            
            document.getElementById('waitingMessage').innerHTML = `
                <i class="fas fa-check-circle"></i>
                <h4>âœ… ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø·Ø§Ù„Ø¨ ${studentId}</h4>
                <p>Ø¬Ø§Ø±ÙŠ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©...</p>
            `;
            
            // ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ·
            setTimeout(() => {
                window.location.href = `/student/${studentId}`;
            }, 1500);
        });

        // Ø¥Ø±Ø³Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ ÙŠØ¯ÙˆÙŠØ§Ù‹
        function sendStudentId() {
            const studentId = document.getElementById('studentId').value.trim();
            if (!studentId) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ù„Ø¨');
                return;
            }
            
            document.getElementById('studentId').value = '';
            socket.emit('scan_result', { student_id: studentId });
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            document.getElementById('waitingMessage').innerHTML = 
                `<i class="fas fa-sync fa-spin"></i><h4>Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ ${studentId}...</h4>`;
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter
        document.getElementById('studentId').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendStudentId();
            }
        });

        // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø¨Ø¹Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù…Ù† ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨
        window.addEventListener('pageshow', function(event) {
            if (event.persisted || (window.performance && window.performance.navigation.type === 2)) {
                // Ø¥Ø°Ø§ Ø¹Ø§Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ØŒ Ø£Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
                document.getElementById('waitingMessage').innerHTML = `
                    <i class="fas fa-hourglass-half"></i>
                    <h4>ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ù…Ø³Ø­ Ø·Ø§Ù„Ø¨...</h4>
                    <p>Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ Ù‡Ù†Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</p>
                `;
                document.getElementById('studentInfo').style.display = 'none';
            }
        });

        // ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('studentId').focus();
        });
    </script>
</body>
</html>