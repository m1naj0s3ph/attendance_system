<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ - Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ±</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- Ø²Ø± ÙØªØ­ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
    <button class="menu-toggle" id="menuToggle">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h4>ğŸ« Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ±</h4>
        </div>
        
        <ul class="sidebar-menu">
            <li><a href="/"><i class="fas fa-home"></i> Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
            <li><a href="/daily_report" class="active"><i class="fas fa-file-alt"></i> Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ</a></li>
            <li><a href="/admin"><i class="fas fa-chart-bar"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</a></li>
            <li><a href="/manage_students"><i class="fas fa-users"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</a></li>
            <li><a href="/bulk_grades"><i class="fas fa-tasks"></i> ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</a></li>
            <li><a href="/add_student"><i class="fas fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</a></li>
            <li><a href="/generate_whatsapp_links"><i class="fab fa-whatsapp"></i> Ø±ÙˆØ§Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨</a></li>
        </ul>
        
        <div class="sidebar-footer">
            <div class="user-info">
                <i class="fas fa-user"></i> {{ username }}
            </div>
            <a href="/logout" class="btn-logout">
                <i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
            </a>
        </div>
    </div>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div class="main-content">
        <!-- Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} fade-in">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">{{ students|length }}</div>
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ students|selectattr("status", "equalto", "Present")|list|length }}</div>
                <div class="stat-label">Ø§Ù„Ø­Ø§Ø¶Ø±ÙŠÙ†</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ students|selectattr("status", "equalto", "Absent")|list|length }}</div>
                <div class="stat-label">Ø§Ù„ØºØ§Ø¦Ø¨ÙŠÙ†</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ "%.2f"|format(total_paid) }} Ø¬.Ù…</div>
                <div class="stat-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø­ØµÙ„</div>
            </div>
        </div>

        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
        <div class="container-box">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="fas fa-file-alt"></i> Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ - {{ date }}</h2>
                <div class="btn-group">
                    <a href="/bulk_grades" class="btn btn-warning">
                        <i class="fas fa-tasks"></i> ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
                    </a>
                    <a href="/generate_whatsapp_links" class="btn btn-success">
                        <i class="fab fa-whatsapp"></i> Ø±ÙˆØ§Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨
                    </a>
                    <a href="/download_daily_summary" class="btn btn-primary">
                        <i class="fas fa-download"></i> ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                    </a>
                </div>
            </div>

            <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ -->
            <div class="table-container">
                <div class="table-header">
                    <h3><i class="fas fa-users"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
                </div>
                
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„ÙƒÙˆØ¯</th>
                                <th>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                                <th>ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>Ø§Ù„Ø¯ÙØ¹</th>
                                <th>Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</th>
                                <th>Ø§Ù„ÙˆØ§Ø¬Ø¨</th>
                                <th>Ø§Ù„Ø±Ø³ÙˆÙ…</th>
                                <th>Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨</th>
                                <th>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø§Ø¶Ø±</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for st in students %}
                                <tr>
                                    <td><strong>{{ st.id }}</strong></td>
                                    <td>{{ st.student_name }}</td>
                                    <td>{{ st.parent_number }}</td>

                                    <td class="{% if st.status == 'Present' %}status-present{% else %}status-absent{% endif %}">
                                        {% if st.status == 'Present' %}
                                            <i class="fas fa-check-circle"></i> {{ st.status }}
                                        {% else %}
                                            <i class="fas fa-times-circle"></i> {{ st.status }}
                                        {% endif %}
                                    </td>

                                    <td class="{% if st.paid == 'Yes' %}paid-yes{% else %}paid-no{% endif %}">
                                        {% if st.paid == 'Yes' %}
                                            <i class="fas fa-check"></i> {{ st.paid }}
                                        {% else %}
                                            <i class="fas fa-times"></i> {{ st.paid }}
                                        {% endif %}
                                    </td>

                                    <td>
                                        {% if st.exam_grade != '-' %}
                                            <span class="badge badge-success">{{ st.exam_grade }}</span>
                                        {% else %}
                                            {{ st.exam_grade }}
                                        {% endif %}
                                    </td>
                                    
                                    <td>
                                        {% if st.homework_status == 'Ø§ØªØ¹Ù…Ù„' %}
                                            <span class="badge badge-success">
                                                <i class="fas fa-check"></i> {{ st.homework_status }}
                                            </span>
                                        {% elif st.homework_status == 'Ù…ØªØ¹Ù…Ù„Ø´' %}
                                            <span class="badge badge-danger">
                                                <i class="fas fa-times"></i> {{ st.homework_status }}
                                            </span>
                                        {% else %}
                                            {{ st.homework_status }}
                                        {% endif %}
                                    </td>
                                    
                                    <td><strong>{{ st.payment_amount }} Ø¬.Ù…</strong></td>
                                    
                                    <td>
                                        {% if st.status == 'Absent' %}
                                        <a href="/manual_send_whatsapp/{{ st.id }}" 
                                           class="btn btn-success btn-sm" 
                                           target="_blank">
                                           <i class="fab fa-whatsapp"></i> ÙˆØ§ØªØ³Ø§Ø¨
                                        </a>
                                        {% else %}
                                        <button class="btn btn-secondary btn-sm" disabled>
                                            <i class="fas fa-check"></i> Ø­Ø§Ø¶Ø±
                                        </button>
                                        {% endif %}
                                    </td>

                                    <td>
                                        {% if st.status == 'Present' %}
                                        <a href="/send_present_report/{{ st.id }}" 
                                           class="btn btn-info btn-sm" 
                                           target="_blank">
                                           <i class="fas fa-paper-plane"></i> Ø¥Ø±Ø³Ø§Ù„
                                        </a>
                                        {% else %}
                                        <button class="btn btn-secondary btn-sm" disabled>
                                            <i class="fas fa-times"></i> ØºØ§Ø¦Ø¨
                                        </button>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>